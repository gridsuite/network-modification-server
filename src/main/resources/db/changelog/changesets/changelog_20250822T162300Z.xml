<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:pro="http://www.liquibase.org/xml/ns/pro"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.1.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.1.xsd"
                   logicalFilePath="db/changelog/changesets/changelog_2022-04-25T10:22:24Z.xml">
    <changeSet id="Update field name from LOAD.ACTIVE_POWER to ACTIVE_POWER_SET_POINT 1/4" author="pirogigo">
        <sql>
            with tmp as (
                select assi.id
                from assignment as assi
                         inner join modification_by_assignment as mba
                                    on mba.id=assi.modification_by_assignment_id
                where mba.equipment_type = 'LOAD'
                  and assi.edited_field in ('ACTIVE_POWER', 'REACTIVE_POWER')
            )
            update assignment
            set edited_field = edited_field || '_SET_POINT'
            where id in (select id from tmp)
        </sql>
    </changeSet>
    <changeSet id="Update field name from LOAD.ACTIVE_POWER to ACTIVE_POWER_SET_POINT 2/4" author="pirogigo">
        <sql>
            with tmp as (
                select form.id
                from formula as form
                         inner join by_formula_modification as bfm
                                    on bfm.id=form.by_formula_modification_id
                where bfm.identifiable_type = 14 --'LOAD'
                  and form.edited_field in ('ACTIVE_POWER', 'REACTIVE_POWER')
            )
            update formula
            set edited_field = edited_field || '_SET_POINT'
            where id in (select id from tmp)
        </sql>
    </changeSet>
    <changeSet id="Update field name from LOAD.ACTIVE_POWER to ACTIVE_POWER_SET_POINT 3/4" author="pirogigo">
        <sql>
            with tmp as (
                select form.id
                from formula as form
                         inner join by_formula_modification as bfm
                                    on bfm.id=form.by_formula_modification_id
                where bfm.identifiable_type = 14 --'LOAD'
                  and form.equipment_field1 in ('ACTIVE_POWER', 'REACTIVE_POWER')
            )
            update formula
            set equipment_field1 = equipment_field1 || '_SET_POINT'
            where id in (select id from tmp)
        </sql>
    </changeSet>
    <changeSet id="Update field name from LOAD.ACTIVE_POWER to ACTIVE_POWER_SET_POINT 4/4" author="pirogigo">
        <sql>
            with tmp as (
                select form.id
                from formula as form
                         inner join by_formula_modification as bfm
                                    on bfm.id=form.by_formula_modification_id
                where bfm.identifiable_type = 14 --'LOAD'
                  and form.equipment_field2 in ('ACTIVE_POWER', 'REACTIVE_POWER')
            )
            update formula
            set equipment_field2 = equipment_field2 || '_SET_POINT'
            where id in (select id from tmp)
        </sql>
    </changeSet>
</databaseChangeLog>
